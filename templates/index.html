<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain DNS System</title>
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/avif" href="logo.avif">
    <link rel="apple-touch-icon" href="logo.avif">
    <link rel="shortcut icon" href="logo.avif">
    
    <!-- Meta Tags for Branding -->
    <meta name="description" content="Decentralized DNS System powered by Blockchain Technology with AI Security">
    <meta name="keywords" content="blockchain, dns, security, decentralized, artificial intelligence">
    <meta name="author" content="Blockchain DNS Team">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Blockchain DNS System">
    <meta property="og:description" content="Decentralized DNS System powered by Blockchain Technology">
    <meta property="og:image" content="rv.png">
    <meta property="og:type" content="website">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
        }

        .header {
            text-align: center;
            padding: 2rem 1rem;
            position: relative;
        }

        .logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
        }

        .logo:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .title {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .nav-tabs-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 0.5rem;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0 0.25rem;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .container {
            max-width: 500px;
            margin: 2rem auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.25);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .input-group i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 1.1rem;
        }

        input[type="text"] {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            font-size: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: #f8fafc;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            flex: 1;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #64748b;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
        }

        .results-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .result-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .result-content {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .status-safe {
            color: #38a169;
            font-weight: 600;
        }

        .status-malicious {
            color: #e53e3e;
            font-weight: 600;
        }

        .status-error {
            color: #d69e2e;
            font-weight: 600;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 3rem auto;
            padding: 0 1rem;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .feature-description {
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .container {
                margin: 1rem;
                padding: 2rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        /* AI Chat Styles */
        .chat-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            line-height: 1.5;
        }

        .chat-message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: 2rem;
        }

        .chat-message.bot {
            background: white;
            border: 1px solid #e2e8f0;
            margin-right: 2rem;
        }

        .quick-question-btn {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-question-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #64748b;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* AI Assistant Chat Hamburger Menu */
        .ai-hamburger {
            background: #667eea;
            border: none;
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            position: relative;
        }

        .ai-hamburger:hover {
            background: #5a6fd8;
            transform: scale(1.05);
        }

        .ai-chat-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 350px;
            max-height: 400px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-10px);
            visibility: hidden;
            transition: all 0.2s ease;
            border: 1px solid #e9ecef;
        }

        .ai-chat-dropdown.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .dropdown-header h3 {
            margin: 0;
            font-size: 0.9rem;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-dropdown-list {
            max-height: 320px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Custom scrollbar for chat dropdown */
        .chat-dropdown-list::-webkit-scrollbar {
            width: 6px;
        }

        .chat-dropdown-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .chat-dropdown-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .chat-dropdown-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .chat-dropdown-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-dropdown-item:hover {
            background: #f8f9fa;
        }

        .chat-dropdown-item:last-child {
            border-bottom: none;
        }

        .chat-dropdown-info {
            flex: 1;
            min-width: 0;
        }

        .chat-dropdown-title {
            font-size: 0.85rem;
            font-weight: 500;
            color: #212529;
            margin-bottom: 0.2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-dropdown-time {
            font-size: 0.7rem;
            color: #6c757d;
        }

        .chat-dropdown-source {
            font-size: 0.6rem;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 0.2rem;
            display: inline-block;
        }

        .chat-dropdown-delete-btn {
            background: none;
            border: none;
            color: #dc3545;
            padding: 4px 6px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
            margin-left: 0.5rem;
        }

        .chat-dropdown-delete-btn:hover {
            opacity: 1;
            background: rgba(220, 53, 69, 0.1);
        }

        .chat-dropdown-clear-all-btn {
            margin: 0.5rem;
            padding: 0.5rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: background 0.2s ease;
            width: calc(100% - 1rem);
            position: sticky;
            bottom: 0;
        }

        .chat-dropdown-clear-all-btn:hover {
            background: #c82333;
        }

        .chat-dropdown-empty {
            padding: 2rem 1rem;
            text-align: center;
            color: #6c757d;
            font-size: 0.85rem;
        }

        /* Enhanced AI Assistant Styles for Index Page */
        .ai-assistant-layout {
            display: flex;
            height: 80vh;
            max-width: 800px; /* Constrain width similar to dashboard */
            margin: 0 auto; /* Center the layout */
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .ai-sidebar {
            width: 300px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .new-chat-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .new-chat-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .recent-chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .chat-item-index {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .chat-item-index:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .chat-item-index:hover .chat-title-index,
        .chat-item-index:hover .chat-time-index,
        .chat-item-index:hover .chat-source {
            color: white;
        }

        .chat-info-index {
            flex: 1;
            min-width: 0;
        }

        .chat-title-index {
            font-size: 0.9rem;
            font-weight: 600;
            color: #495057;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0.25rem;
        }

        .chat-time-index {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .chat-source {
            font-size: 0.7rem;
            color: #667eea;
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .delete-chat-btn-index {
            background: none;
            border: none;
            color: #dc3545;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            margin-left: 0.5rem;
        }

        .chat-item-index:hover .delete-chat-btn-index {
            opacity: 1;
            color: white;
        }

        .delete-chat-btn-index:hover {
            background: rgba(255,255,255,0.2);
        }

        .ai-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Allow children to shrink for scroll */
        }

        .ai-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-status-indicator {
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .full-chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Important for proper flexbox behavior */
        }

        .chat-messages-full {
            flex: 1 1 0%;
            padding: 1.5rem;
            overflow-y: auto !important;
            background: #fff;
            min-height: 0 !important;
            max-height: 100%;
        }

        .message-index {
            display: flex;
            margin-bottom: 1.5rem;
            align-items: flex-start;
            gap: 1rem;
        }

        .message-avatar-index {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .user-message-index .message-avatar-index {
            background: #667eea;
            color: white;
        }

        .assistant-message-index .message-avatar-index {
            background: #28a745;
            color: white;
        }

        .message-content-index {
            background: #f8f9fa;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            max-width: 70%;
            word-wrap: break-word;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .user-message-index {
            flex-direction: row-reverse;
        }

        .user-message-index .message-content-index {
            background: #667eea;
            color: white;
        }

        /* Styling for formatted AI responses */
        .message-content-index strong {
            font-weight: 600;
            color: inherit;
        }

        .message-content-index em {
            font-style: italic;
            color: inherit;
        }

        .message-content-index code {
            background: rgba(0, 0, 0, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .message-content-index ul {
            margin: 0.5rem 0;
            padding-left: 1.2rem;
        }

        .message-content-index li {
            margin: 0.2rem 0;
            list-style-type: disc;
        }

        .quick-questions-full {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .quick-questions-full h3 {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            color: #495057;
            font-weight: 600;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .chat-input-full {
            display: flex;
            padding: 1.5rem;
            border-top: 1px solid #e9ecef;
            background: white;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .chat-input-full input {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border: 1px solid #dee2e6;
            border-radius: 25px;
            outline: none;
            font-size: 0.9rem;
        }

        .chat-input-full input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .chat-input-full button {
            width: 45px;
            height: 45px;
            background: #667eea;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .chat-input-full button:hover {
            background: #5a6fd8;
        }

        /* Responsive Design for Index AI */
        @media (max-width: 768px) {
            .ai-assistant-layout {
                flex-direction: column;
                height: auto;
            }
            
            .ai-sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .question-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <div class="header">
        <img class="logo" src="rv.png" alt="Blockchain DNS Logo" />
        <h1 class="title">Blockchain DNS System</h1>
        <p class="subtitle">Decentralized Domain Name System powered by Blockchain Technology and Machine Learning Security</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs-container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('lookup')">
                <i class="fas fa-search"></i>
                DNS Lookup
            </button>
            <button class="nav-tab" onclick="switchTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard
            </button>
            <div class="ai-nav-container">
                <button class="nav-tab" onclick="switchTab('ai-assistant')">
                    <i class="fas fa-robot"></i>
                    AI Assistant
                </button>
            </div>
        </div>
    </div>

    <!-- DNS Lookup Tab -->
    <div class="tab-content active" id="lookup-tab">
        <div class="container">
            <h2 class="section-title">
                <i class="fas fa-search"></i>
                Domain Analysis & Lookup
            </h2>
            
            <div class="input-group">
                <i class="fas fa-globe"></i>
                <input type="text" id="hostname" placeholder="Enter domain name (e.g., example.com)" autocomplete="off">
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="checkDomain()">
                    <i class="fas fa-shield-alt"></i>
                    Analyze Security
                </button>
                <button class="btn btn-secondary" onclick="lookupDNS()" id="lookupBtn" disabled>
                    <i class="fas fa-search"></i>
                    DNS Lookup
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard Tab -->
    <div class="tab-content" id="dashboard-tab">
        <div class="dashboard-container">
            <iframe src="http://127.0.0.1:5001/dashboard" width="100%" height="800px" frameborder="0" style="border-radius: 15px; background: white;"></iframe>
        </div>
    </div>

    <!-- AI Assistant Tab -->
    <div class="tab-content" id="ai-assistant-tab">
        <div class="ai-assistant-layout">
            <!-- Chat Main Area (Full Width) -->
            <div class="ai-main" style="width: 100%;">
                <div class="ai-header">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="position: relative;">
                            <button class="ai-hamburger" onclick="toggleChatDropdown(event)" title="Recent Chats">
                                <i class="fas fa-bars"></i>
                            </button>
                            <!-- Recent Chats Dropdown -->
                            <div class="ai-chat-dropdown" id="aiChatDropdown">
                                <div class="dropdown-header">
                                    <h3><i class="fas fa-history"></i> Recent Chats</h3>
                                </div>
                                <div id="chatDropdownChatsList" class="chat-dropdown-list">
                                    <div style="padding: 1rem; text-align: center; color: #6c757d; font-size: 0.8rem;">Loading...</div>
                                </div>
                            </div>
                        </div>
                        <h2 class="section-title">
                            <i class="fas fa-robot"></i>
                            AI Assistant
                        </h2>
                    </div>
                    <div id="ai-status" class="ai-status-indicator">
                        <div class="loading"></div> Checking AI availability...
                    </div>
                </div>
                
                <div id="chat-container" class="full-chat-container">
                    <div style="display: flex; flex-direction: column; height: 100%; flex: 1; min-height: 0;">
                        <div id="indexChatMessages" class="chat-messages-full" style="flex: 1 1 0%; min-height: 0; overflow-y: auto;">
                            <!-- Messages will be added here -->
                        </div>
                        <div class="quick-questions-full" style="flex-shrink: 0;">
                            <h3>Live Data Analysis:</h3>
                            <div class="question-grid">
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('What are the current security statistics?')">Current Security Stats</button>
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('Analyze current blockchain status')">Blockchain Status</button>
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('What threats were detected recently?')">Recent Threats</button>
                                <button class="quick-question-btn" onclick="getIndexSystemSummary()">System Summary</button>
                            </div>
                            <h3>General Questions:</h3>
                            <div class="question-grid">
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('How does blockchain DNS work?')">How does blockchain DNS work?</button>
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('Explain the mining process')">Mining Process</button>
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('How to add DNS records?')">Add DNS Records</button>
                                <button class="quick-question-btn" onclick="askIndexQuickQuestion('What makes this system secure?')">Security Features</button>
                            </div>
                        </div>
                        <div class="chat-input-full" style="flex-shrink: 0;">
                            <input type="text" id="indexChatInput" placeholder="Ask me about blockchain DNS, security, or dashboard data..." autocomplete="off">
                            <button onclick="sendIndexChatMessage()" title="Send">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="results-container">
        <div id="securityResult" class="result-card" style="display: none;">
            <div class="result-title">
                <i class="fas fa-shield-alt"></i>
                Security Analysis
            </div>
            <div class="result-content" id="resultP"></div>
        </div>
        
        <div id="dnsResult" class="result-card" style="display: none;">
            <div class="result-title">
                <i class="fas fa-server"></i>
                DNS Resolution
            </div>
            <div class="result-content" id="result"></div>
        </div>
    </div>

    <div class="feature-grid">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-cube"></i>
            </div>
            <h3 class="feature-title">Blockchain Technology</h3>
            <p class="feature-description">Decentralized DNS records stored on an immutable blockchain ledger</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h3 class="feature-title">AI Security</h3>
            <p class="feature-description">Machine learning algorithms detect malicious domains before resolution</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-network-wired"></i>
            </div>
            <h3 class="feature-title">Distributed Network</h3>
            <p class="feature-description">Multiple nodes ensure high availability and consensus</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h3 class="feature-title">Tamper Resistant</h3>
            <p class="feature-description">Cryptographic security prevents unauthorized DNS modifications</p>
        </div>
    </div>

    <script>
        // Clear any cached DNS results on page load to prevent contamination
        document.addEventListener('DOMContentLoaded', function() {
            // Clear any old DNS results
            const dnsResultCard = document.getElementById('dnsResult');
            if (dnsResultCard) {
                dnsResultCard.style.display = 'none';
                dnsResultCard.classList.remove('show');
            }
            
            // Clear local session DNS data
            sessionStorage.removeItem('indexDnsResults');
        });

        // Enhanced JavaScript with better UX
        let isAnalyzing = false;
        let isLookingUp = false;

        function showResultCard(cardId) {
            const card = document.getElementById(cardId);
            card.style.display = 'block';
            setTimeout(() => {
                card.classList.add('show');
            }, 100);
        }

        function hideResultCard(cardId) {
            const card = document.getElementById(cardId);
            card.classList.remove('show');
            setTimeout(() => {
                card.style.display = 'none';
            }, 300);
        }

        async function checkDomain() {
            if (isAnalyzing) return;
            
            const domain = document.getElementById('hostname').value.trim();
            const resultText = document.getElementById('resultP');
            const lookupBtn = document.getElementById('lookupBtn');
            const analyzeBtn = document.querySelector('.btn-primary');

            if (!domain) {
                resultText.innerHTML = '<span class="status-error">Please enter a domain name</span>';
                showResultCard('securityResult');
                return;
            }

            isAnalyzing = true;
            analyzeBtn.innerHTML = '<div class="loading"></div> Analyzing...';
            analyzeBtn.disabled = true;

            // Show result card with loading state
            resultText.innerHTML = '<div class="loading"></div> Analyzing domain security...';
            showResultCard('securityResult');

            try {
                const response = await fetch('http://127.0.0.1:5000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ domain: domain })
                });

                const data = await response.json();

                if (data.error) {
                    resultText.innerHTML = `<span class="status-error">Error: ${data.error}</span>`;
                    lookupBtn.disabled = true;
                    lookupBtn.className = 'btn btn-secondary';
                } else {
                    const isSecure = (data.label || "").trim().toLowerCase() === "safe";
                    const statusClass = isSecure ? 'status-safe' : 'status-malicious';
                    const icon = isSecure ? 'fa-check-circle' : 'fa-exclamation-triangle';
                    
                    resultText.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 1.1rem;">
                            <i class="fas ${icon}"></i>
                            <span class="${statusClass}">${data.label.toUpperCase()}</span>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #64748b;">
                            ${isSecure ? 'This domain appears to be safe for DNS resolution.' : 'This domain has been flagged as potentially malicious.'}
                        </div>
                    `;

                    // Update lookup button
                    if (isSecure) {
                        lookupBtn.disabled = false;
                        lookupBtn.className = 'btn btn-success';
                        lookupBtn.innerHTML = '<i class="fas fa-search"></i> DNS Lookup';
                    } else {
                        lookupBtn.disabled = true;
                        lookupBtn.className = 'btn btn-secondary';
                        lookupBtn.innerHTML = '<i class="fas fa-ban"></i> Blocked';
                    }
                }
            } catch (err) {
                resultText.innerHTML = '<span class="status-error">Failed to connect to security API</span>';
                lookupBtn.disabled = true;
                lookupBtn.className = 'btn btn-secondary';
                console.error(err);
            } finally {
                isAnalyzing = false;
                analyzeBtn.innerHTML = '<i class="fas fa-shield-alt"></i> Analyze Security';
                analyzeBtn.disabled = false;
            }
        }

        async function lookupDNS() {
            if (isLookingUp) return;
            
            const hostname = document.getElementById('hostname').value.trim();
            const resultDiv = document.getElementById('result');
            const lookupBtn = document.getElementById('lookupBtn');

            if (!hostname) {
                resultDiv.innerHTML = '<span class="status-error">Please enter a domain name</span>';
                showResultCard('dnsResult');
                return;
            }

            isLookingUp = true;
            lookupBtn.innerHTML = '<div class="loading"></div> Looking up...';
            lookupBtn.disabled = true;

            // Show result card with loading state
            resultDiv.innerHTML = '<div class="loading"></div> Searching blockchain DNS records...';
            showResultCard('dnsResult');
            
            // Store that this is an index page lookup
            sessionStorage.setItem('indexDnsLookupActive', 'true');

            try {
                const response = await fetch('http://127.0.0.1:5002/dns/request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ hostname })
                });

                const data = await response.json();
                
                if (response.ok) {
                    const securityInfo = data.security || {};
                    const securityClass = securityInfo.label === 'malicious' ? 'status-error' : 'status-safe';
                    const securityIcon = securityInfo.label === 'malicious' ? 'fa-exclamation-triangle' : 'fa-check-circle';
                    
                    resultDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle status-safe"></i>
                            <span class="status-safe">DNS Record Found</span>
                        </div>
                        
                        ${securityInfo.label ? `
                        <div style="background: ${securityInfo.label === 'malicious' ? '#fed7d7' : '#f0fff4'}; padding: 1rem; border-radius: 8px; border-left: 4px solid ${securityInfo.label === 'malicious' ? '#f56565' : '#48bb78'}; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <i class="fas ${securityIcon} ${securityClass}"></i>
                                <strong>Security Analysis: ${securityInfo.label.toUpperCase()}</strong>
                            </div>
                            <div style="font-size: 0.9rem; color: #64748b;">
                                Confidence: ${securityInfo.confidence ? (securityInfo.confidence * 100).toFixed(1) + '%' : 'N/A'}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div style="background: #f0f9ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #667eea;">
                            <div style="margin-bottom: 0.5rem;"><strong>IP Address:</strong> ${data.ip}</div>
                            <div><strong>Port:</strong> ${data.port}</div>
                        </div>
                    `;
                } else {
                    const securityInfo = data.security || {};
                    resultDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-exclamation-circle status-error"></i>
                            <span class="status-error">No DNS record found for "${hostname}"</span>
                        </div>
                        
                        ${securityInfo.label ? `
                        <div style="background: ${securityInfo.label === 'malicious' ? '#fed7d7' : '#f0fff4'}; padding: 1rem; border-radius: 8px; border-left: 4px solid ${securityInfo.label === 'malicious' ? '#f56565' : '#48bb78'}; margin-top: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <i class="fas ${securityInfo.label === 'malicious' ? 'fa-exclamation-triangle' : 'fa-check-circle'} ${securityInfo.label === 'malicious' ? 'status-error' : 'status-safe'}"></i>
                                <strong>Security Analysis: ${securityInfo.label.toUpperCase()}</strong>
                            </div>
                            <div style="font-size: 0.9rem; color: #64748b;">
                                Confidence: ${securityInfo.confidence ? (securityInfo.confidence * 100).toFixed(1) + '%' : 'N/A'}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #64748b;">
                            This domain is not registered in the blockchain DNS system.
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-exclamation-triangle status-error"></i>
                        <span class="status-error">Error contacting DNS server</span>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #64748b;">
                        Please check if the blockchain DNS node is running on port 5001.
                    </div>
                `;
                console.error(error);
            } finally {
                isLookingUp = false;
                lookupBtn.innerHTML = '<i class="fas fa-search"></i> DNS Lookup';
                lookupBtn.disabled = false;
            }
        }

        // Enter key support
        document.getElementById('hostname').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkDomain();
            }
        });

        // Auto-focus on input
        document.getElementById('hostname').focus();

        // Tab switching functionality
        function switchTab(tabName) {
            // Clear DNS results when switching away from lookup tab to prevent contamination
            if (tabName !== 'lookup') {
                const dnsResultCard = document.getElementById('dnsResult');
                if (dnsResultCard) {
                    dnsResultCard.style.display = 'none';
                    dnsResultCard.classList.remove('show');
                }
                sessionStorage.removeItem('indexDnsLookupActive');
            }
            
            // Hide chat dropdown when switching tabs
            hideChatDropdown();
            
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');

            // Initialize AI status when AI tab is selected
            if (tabName === 'ai-assistant') {
                checkAIStatus();
            }
        }

        // Chat dropdown functionality for AI Assistant
        function toggleChatDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('aiChatDropdown');
            
            if (dropdown.classList.contains('show')) {
                hideChatDropdown();
            } else {
                showChatDropdown();
            }
        }

        function showChatDropdown() {
            const dropdown = document.getElementById('aiChatDropdown');
            dropdown.classList.add('show');
            loadChatDropdownChats();
            
            // Add click outside listener
            setTimeout(() => {
                document.addEventListener('click', handleClickOutsideChatDropdown);
            }, 0);
        }

        function hideChatDropdown() {
            const dropdown = document.getElementById('aiChatDropdown');
            dropdown.classList.remove('show');
            
            // Remove click outside listener
            document.removeEventListener('click', handleClickOutsideChatDropdown);
        }

        function handleClickOutsideChatDropdown(event) {
            const dropdown = document.getElementById('aiChatDropdown');
            const hamburger = document.querySelector('.ai-hamburger');
            
            if (!dropdown.contains(event.target) && !hamburger.contains(event.target)) {
                hideChatDropdown();
            }
        }

        function loadChatDropdownChats() {
            const chatList = document.getElementById('chatDropdownChatsList');
            chatList.innerHTML = '';
            
            // Load from global chat history
            const globalHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
            
            if (globalHistory.length === 0) {
                chatList.innerHTML = `
                    <div class="chat-dropdown-empty">
                        <i class="fas fa-comments" style="font-size: 2rem; margin-bottom: 0.5rem; color: #dee2e6;"></i>
                        <div>No chats yet</div>
                        <div style="font-size: 0.75rem; margin-top: 0.25rem;">Start a conversation below!</div>
                    </div>
                `;
                return;
            }
            
            // Show up to 15 chats with scroll
            globalHistory.slice(0, 15).forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-dropdown-item';
                chatItem.innerHTML = `
                    <div class="chat-dropdown-info" onclick="loadChatFromDropdown('${chat.id}')">
                        <div class="chat-dropdown-title">${chat.title}</div>
                        <div class="chat-dropdown-time">${formatIndexTime(chat.timestamp)}</div>
                        <div class="chat-dropdown-source">${chat.source === 'dashboard' ? '📊 Dashboard' : '🏠 Index'}</div>
                    </div>
                    <button class="chat-dropdown-delete-btn" onclick="deleteChatFromDropdown('${chat.id}')" title="Delete chat">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                chatList.appendChild(chatItem);
            });
            
            // Add "Clear All" button if there are chats
            if (globalHistory.length > 0) {
                const clearAllBtn = document.createElement('button');
                clearAllBtn.className = 'chat-dropdown-clear-all-btn';
                clearAllBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Clear All Chats';
                clearAllBtn.onclick = clearAllChatsFromDropdown;
                chatList.appendChild(clearAllBtn);
            }
        }

        function loadChatFromDropdown(chatId) {
            hideChatDropdown();
            loadIndexChat(chatId);
        }

        function deleteChatFromDropdown(chatId) {
            if (confirm('Delete this chat?')) {
                // Remove from global history
                let globalHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
                globalHistory = globalHistory.filter(c => c.id !== chatId);
                localStorage.setItem('aiChatHistory', JSON.stringify(globalHistory));
                
                // Reload chat dropdown
                loadChatDropdownChats();
                
                // If this was the current chat, start a new one or load another
                if (indexCurrentChatId === chatId) {
                    if (globalHistory.length > 0) {
                        const mostRecent = globalHistory[0];
                        loadIndexChat(mostRecent.id);
                    } else {
                        startNewIndexChat();
                    }
                }
            }
        }

        function clearAllChatsFromDropdown() {
            if (confirm('Delete all chat history? This cannot be undone.')) {
                localStorage.removeItem('aiChatHistory');
                loadChatDropdownChats();
                
                // Start a new chat since all are cleared
                startNewIndexChat();
            }
        }

        // Enhanced AI Assistant Functions for Index Page
        let indexChatHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
        let indexCurrentChatId = null;

        async function checkAIStatus() {
            const statusIndicator = document.querySelector('.ai-status-indicator');
            const chatContainer = document.getElementById('chat-container');

            try {
                const response = await fetch('http://127.0.0.1:5000/ai-status');
                const data = await response.json();

                if (data.available) {
                    statusIndicator.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
                            <span style="color: #22c55e;">AI Assistant Ready</span>
                        </div>
                    `;
                    chatContainer.style.display = 'block';
                    loadIndexRecentChats();
                    if (!indexCurrentChatId) {
                        startNewIndexChat();
                    }
                } else {
                    statusIndicator.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></div>
                            <span style="color: #ef4444;">AI Assistant Offline</span>
                        </div>
                    `;
                    chatContainer.style.display = 'none';
                }
            } catch (error) {
                statusIndicator.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 8px; height: 8px; background: #ef4444; border-radius: 50%;"></div>
                        <span style="color: #ef4444;">AI Assistant Offline</span>
                    </div>
                `;
                chatContainer.style.display = 'none';
            }
        }

        function startNewIndexChat() {
            indexCurrentChatId = 'index_chat_' + Date.now();
            const newChat = {
                id: indexCurrentChatId,
                title: 'New Chat',
                messages: [],
                timestamp: new Date().toISOString(),
                source: 'index'
            };
            
            // Add to global chat history
            let globalHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
            globalHistory.unshift(newChat);
            localStorage.setItem('aiChatHistory', JSON.stringify(globalHistory));
            
            loadIndexRecentChats();
            clearIndexChatMessages();
            
            // Add welcome message
            addIndexMessageToChat('assistant', 'Hello! I\'m your Blockchain DNS AI Assistant. I can help you understand your dashboard data, security analytics, and blockchain performance. What would you like to know?');
        }

        function loadIndexChat(chatId) {
            indexCurrentChatId = chatId;
            
            // Load from global chat history
            let globalHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
            const chat = globalHistory.find(c => c.id === chatId);
            
            if (chat) {
                clearIndexChatMessages();
                chat.messages.forEach(msg => {
                    addIndexMessageToChat(msg.role, msg.content, false);
                });
                scrollIndexToBottom();
            }
        }

        function deleteIndexChat(chatId) {
            if (confirm('Delete this chat?')) {
                // Remove from global history
                let globalHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
                globalHistory = globalHistory.filter(c => c.id !== chatId);
                localStorage.setItem('aiChatHistory', JSON.stringify(globalHistory));
                
                // Reload recent chats
                loadIndexRecentChats();
                
                // If this was the current chat, start a new one or load another
                if (indexCurrentChatId === chatId) {
                    if (globalHistory.length > 0) {
                        // Load the most recent chat
                        const mostRecent = globalHistory[0];
                        loadIndexChat(mostRecent.id);
                    } else {
                        // Start fresh if no chats left
                        startNewIndexChat();
                    }
                }
            }
        }

        function clearAllIndexChats() {
            if (confirm('Delete all chat history? This cannot be undone.')) {
                localStorage.removeItem('aiChatHistory');
                loadIndexRecentChats();
                startNewIndexChat();
            }
        }

        function loadIndexRecentChats() {
            // This function is no longer needed since we removed the sidebar
            // Recent chats are now handled by the nav dropdown
            return;
        }

        function updateChatCountBadge(count) {
            // No badge anymore since we removed the sidebar
            return;
        }

        function formatIndexTime(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${diffDays}d ago`;
        }

        function saveIndexChatHistory() {
            localStorage.setItem('aiChatHistory', JSON.stringify(indexChatHistory));
        }

        function clearIndexChatMessages() {
            document.getElementById('indexChatMessages').innerHTML = '';
        }

        // Convert basic Markdown to HTML for AI responses
        function markdownToHtml(text) {
            if (!text) return '';
            
            return text
                // Convert **bold** to <strong>bold</strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Convert *italic* to <em>italic</em>
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Convert `code` to <code>code</code>
                .replace(/`(.*?)`/g, '<code>$1</code>')
                // Convert line breaks to <br>
                .replace(/\n/g, '<br>')
                // Convert bullet points (starting with * or -)
                .replace(/^[\*\-]\s+(.+)$/gm, '<li>$1</li>')
                // Wrap consecutive <li> elements in <ul>
                .replace(/(<li>.*<\/li>(?:\s*<li>.*<\/li>)*)/gs, '<ul>$1</ul>')
                // Convert numbered lists (starting with numbers)
                .replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>')
                // Clean up any remaining line breaks around lists
                .replace(/<br>\s*<ul>/g, '<ul>')
                .replace(/<\/ul>\s*<br>/g, '</ul>');
        }

        function addIndexMessageToChat(role, content, save = true) {
            const messagesContainer = document.getElementById('indexChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-index ${role}-message-index`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar-index';
            avatar.innerHTML = role === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content-index';
            
            // Convert Markdown to HTML for bot messages, keep text for user messages
            if (role === 'assistant' || role === 'bot') {
                contentDiv.innerHTML = markdownToHtml(content);
            } else {
                contentDiv.textContent = content;
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            if (save && indexCurrentChatId) {
                // Update global chat history
                let globalHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');
                let chat = globalHistory.find(c => c.id === indexCurrentChatId);
                
                if (!chat) {
                    chat = {
                        id: indexCurrentChatId,
                        title: 'New Chat',
                        messages: [],
                        timestamp: new Date().toISOString(),
                        source: 'index'
                    };
                    globalHistory.unshift(chat);
                }
                
                chat.messages.push({ role, content, timestamp: new Date().toISOString() });
                
                // Update chat title with first user message
                if (role === 'user' && chat.messages.filter(m => m.role === 'user').length === 1) {
                    chat.title = content.slice(0, 30) + (content.length > 30 ? '...' : '');
                }
                
                localStorage.setItem('aiChatHistory', JSON.stringify(globalHistory));
                loadIndexRecentChats();
            }
            
            scrollIndexToBottom();
        }

        function scrollIndexToBottom() {
            const messagesContainer = document.getElementById('indexChatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendIndexChatMessage() {
            const input = document.getElementById('indexChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addIndexMessageToChat('user', message);
            input.value = '';
            
            // Show typing indicator
            showIndexTypingIndicator();
            
            try {
                const response = await fetch('http://127.0.0.1:5000/ai-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });
                
                const data = await response.json();
                hideIndexTypingIndicator();
                
                if (data.error) {
                    addIndexMessageToChat('assistant', `Error: ${data.error}`);
                } else {
                    addIndexMessageToChat('assistant', data.response);
                }
            } catch (error) {
                hideIndexTypingIndicator();
                addIndexMessageToChat('assistant', 'Sorry, I encountered an error. Please try again.');
            }
        }

        function showIndexTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'indexTypingIndicator';
            indicator.className = 'message-index assistant-message-index typing-indicator';
            indicator.innerHTML = `
                <div class="message-avatar-index"><i class="fas fa-robot"></i></div>
                <div class="message-content-index">
                    <div class="typing-dots">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                </div>
            `;
            document.getElementById('indexChatMessages').appendChild(indicator);
            scrollIndexToBottom();
        }

        function hideIndexTypingIndicator() {
            const indicator = document.getElementById('indexTypingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Quick question buttons
        function askIndexQuickQuestion(question) {
            document.getElementById('indexChatInput').value = question;
            sendIndexChatMessage();
        }

        async function getIndexSystemSummary() {
            askIndexQuickQuestion('Provide a comprehensive summary of the current system state');
        }

        // Handle enter key in chat input
        document.addEventListener('DOMContentLoaded', function() {
            const indexChatInput = document.getElementById('indexChatInput');
            if (indexChatInput) {
                indexChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendIndexChatMessage();
                    }
                });
            }
            
            // Prevent quick dropdown from closing when clicking inside it
            const quickChatDropdown = document.getElementById('quickChatDropdown');
            if (quickChatDropdown) {
                quickChatDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
    </script>
</body>
</html>
